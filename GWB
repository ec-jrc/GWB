#!/bin/bash
#
echo "==============================================================================="
echo "              GWB: GuidosToolbox-Workbench"
echo "==============================================================================="
echo "     Part A: brief module description"
echo "==============================================================================="
echo "cmd-line image analysis modules from GuidosToolbox "
echo "(https://forest.jrc.ec.europa.eu/en/activities/lpa/gtb/):"
echo "Usage of GWB implies compliance with the conditions in the EULA_GWB.pdf"
echo "(https://ies-ows.jrc.ec.europa.eu/gtb/GWB/EULA_GWB.pdf)"
echo " "
echo "GWB_check4updates"
echo "  Display installed and current program version"
echo "  and test for program updates"
echo " "
echo "GWB_ACC: Accounting of image objects and area classes"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing, "
echo "  optional: 3b-special background 1, 4b-special background 2"
echo "  Parameter file: input/acc-parameters.txt"
echo " "
echo "GWB_DIST: Euclidean Distance and Hypsometric Curve"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing"
echo "  Parameter file: input/dist-parameters.txt"
echo " "
echo "GWB_FAD: Multiscale fragmentation analysis"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing, "
echo "  optional: 3b-special BG, 4b-non-fragmenting BG"
echo "  Parameter file: input/fad-parameters.txt"
echo " "
echo "GWB_FRAG: user-selected custom scale fragmentation analysis"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing, "
echo "  optional: 3b-special BG, 4b-non-fragmenting BG"
echo "  Parameter file: input/frag-parameters.txt"
echo " "
echo "GWB_LM: Landscape Mosaic "
echo "  Requirements: 1b-Agriculture, 2b-Natural, 3b-Developed "
echo "  optional: 0b-missing"
echo "  Parameter file: input/lm-parameters.txt"
echo " "
echo "GWB_MSPA: Morphological Spatial Pattern Analysis (up to 25 classes)"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing"
echo "  Parameter file: input/mspa-parameters.txt"
echo " "
echo "GWB_PARC: Landscape Parcellation index"
echo "  Requirements: [1b, 255b]-land cover classes, optional: 0b-missing"
echo "  Parameter file: input/parc-parameters.txt"
echo " "
echo "GWB_REC: Recode class values"
echo "  Requirements: categorical map with up to 256 classes within [0b, 255b]"
echo "  Parameter file: input/rec-parameters.txt"
echo " "
echo "GWB_RSS: Restoration Status summary"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing"
echo "  Parameter file: input/rss-parameters.txt"
echo " "
echo "GWB_SPA: Spatial Pattern Analysis (2, 3, 5, or 6 classes)"
echo "  Requirements: 1b-BG, 2b-FG, optional: 0b-missing"
echo "  Parameter file: input/spa-parameters.txt"
echo " "
echo "GWB_SPATCON: moving window analysis of proportion and attribute adjacency table"
echo "  Requirements: categorical map within [0b, 255b]"
echo "  Parameter file: input/spatcon-parameters.txt"
echo " "
echo "More details in the module-specific parameter files, or run: GWB_XXX --help"
echo " "
echo "==============================================================================="
echo "     Part B: usage"
echo "==============================================================================="
echo "a) standalone mode (within the directory GWB): ./GWB_ACC "
echo "   OR add a custom full path to your input and output directory, i.e.: "
echo "   ./GWB_ACC -i=$HOME/input -o=$HOME/output"
echo " "
echo "b) system mode (GWB installed in /opt/GWB/): "
echo "   To get started in system mode, copy the input/output directories to"
echo "   your $HOME folder using the command: cp -fr /opt/GWB/*put ~/"
echo "   To process, add the full path to your input and output directory: "
echo "   GWB_ACC -i=$HOME/input -o=$HOME/output"
echo " "
echo "==============================================================================="
echo "     Part C: processing requirements"
echo "==============================================================================="
echo "RAM requirements depend on module processing settings and the amount "
echo "and the configuration of objects in the input image."
echo "You can use: /usr/bin/time -v <full GWB-command> and then look "
echo "at 'Maximum resident set size', which will show the maximum "
echo "RAM usage point (in kb) encountered during execution."
echo " a) RAMpeakGB = divide 'Maximum resident set size' by 1024^2"
echo " b) imsizeGB = image size in GB = xdim*ydim/1024^3"
echo " c) processing RAM requirement by module: RAMpeak/imsizeGB"
echo " "
echo "Approximate peak RAM usage factors for an image of size imsizeGB: "
echo "GWB_ACC    : 30 * imsizeGB"
echo "GWB_DIST   : 18 * imsizeGB"
echo "GWB_FAD    : 30 * imsizeGB"
echo "GWB_FRAG   : 13 * imsizeGB"
echo "GWB_LM     :  9 * imsizeGB"
echo "GWB_MSPA   : 20 * imsizeGB"
echo "GWB_PARC   : 22 * imsizeGB"
echo "GWB_REC    :  2 * imsizeGB"
echo "GWB_RSS    : 20 * imsizeGB"
echo "GWB_SPA    : 20 * imsizeGB"
echo "GWB_SPATCON: metric-dependent"
echo "Example: input image 50,000 x 50,000 pixels -> imsizeGB = 2.33 GB. "
echo "Processing this image for GWB_ACC will require 30 * 2.33 ~ 70 GB RAM"
echo " "
echo "The RAM usage factors above are indicative only. They depend on module "
echo "settings and the amount/configuration of objects in the input image."
echo "==============================================================================="
echo " ***  To read all GWB information in Part A, B, C above,   ***"
echo " ***  either scroll up or run the command:   less /usr/bin/GWB  ***"
echo "==============================================================================="
# Find the location of this script and check status of GWB
topdir=$(dirname "$0")
if test "$topdir" = "." ; then
   topdir=$PWD;
fi
checker="$topdir"/GWB_check4updates
if [[ -f "$checker" ]];then
$checker
fi
